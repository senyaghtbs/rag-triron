apiVersion: v1
kind: ConfigMap
metadata:
  name: rag-system-model-source
  labels:
    app: rag-system
    component: triton
data:
  # Пример конфигурации модели для Triton
  model-config.py: |
    import os
    
    def load_model_config():
        return {
            "model_name": "rag-system",
            "model_type": "ensemble",
            "max_batch_size": 8,
            "input": {
                "name": "input_text",
                "dtype": "BYTES",
                "dims": [1]
            },
            "output": {
                "name": "output_embeddings", 
                "dtype": "FP32",
                "dims": [1024]
            }
        }
  
  # Базовый конфиг для Triton
  config.pbtxt: |
    name: "rag_system_model"
    platform: "python"
    max_batch_size: 8
    
    input [
      {
        name: "input_text"
        data_type: TYPE_STRING
        dims: [ -1 ]
      }
    ]
    
    output [
      {
        name: "output_embeddings"
        data_type: TYPE_FP32
        dims: [ 1024 ]
      }
    ]
    
    instance_group [
      {
        kind: KIND_GPU
        count: 1
      }
    ]
  
  # Файл с настройками
  settings.properties: |
    model.repository=/models
    inference.port=8000
    metrics.port=8002
    http.port=8001